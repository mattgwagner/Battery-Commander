@model Soldier

<div class="panel panel-default">

    <div class="panel-heading">
        <h1 class="panel-title">@Html.DisplayFor(model => model) @Html.ActionLink("Edit", "Edit", new { Model.Id }, new { @class = "btn btn-default" })</h1>
    </div>

    <table class="table">
        <tr>
            <td>@Html.DisplayNameFor(model => model.DateOfBirth)</td>
            <td>@Html.DisplayFor(model => model.DateOfBirth) (@Html.DisplayFor(model => model.Age) y/o)</td>
        </tr>
        <tr>
            <td>@Html.DisplayNameFor(model => model.MilitaryEmail)</td>
            <td>@Html.DisplayFor(model => model.MilitaryEmail)</td>
        </tr>
        <tr>
            <td>@Html.DisplayNameFor(model => model.DoDId)</td>
            <td>@Html.DisplayFor(model => model.DoDId)</td>
        </tr>
        <tr>
            <td>@Html.DisplayNameFor(model => model.CivilianEmail)</td>
            <td>@Html.DisplayFor(model => model.CivilianEmail)</td>
        </tr>
        <tr>
            <td>@Html.DisplayNameFor(model => model.Gender)</td>
            <td>@Html.DisplayFor(model => model.Gender)</td>
        </tr>
        <tr>
            <td>@Html.DisplayNameFor(model => model.Unit)</td>
            <td>@Html.DisplayFor(model => model.Unit)</td>
        </tr>
        <tr>
            <td>@Html.DisplayNameFor(model => model.ETSDate)</td>
            <td>@Html.DisplayFor(model => model.ETSDate) (@Html.DisplayFor(model => model.TimeTillETS))</td>
        </tr>
    </table>
</div>

<div class="panel panel-default">

    <div class="panel-heading">
        <h2 class="panel-title">@Html.DisplayNameFor(_ => _.APFTs) @Html.ActionLink("Add New", "New", "APFT", new { soldier = Model.Id }, new { @class = "btn btn-default btn-xs" })</h2>
    </div>

    <div class="panel-body">
        <table class="table">
            <thead>
                <tr>
                    <th>@Html.DisplayNameFor(_ => _.APFTs.FirstOrDefault().Date)</th>
                    <th>@Html.DisplayNameFor(_ => _.APFTs.FirstOrDefault().PushUps)</th>
                    <th>@Html.DisplayNameFor(_ => _.APFTs.FirstOrDefault().SitUps)</th>
                    <th>@Html.DisplayNameFor(_ => _.APFTs.FirstOrDefault().Run)</th>
                    <th>@Html.DisplayNameFor(_ => _.APFTs.FirstOrDefault().TotalScore)</th>
                    <th>@Html.DisplayNameFor(_ => _.APFTs.FirstOrDefault().IsPassing)</th>
                    <th></th>
                </tr>
            </thead>

            <tbody>
                @foreach (var apft in Model.APFTs.OrderByDescending(_ => _.Date))
                {
                    <tr>
                        <td>@Html.DisplayFor(_ => apft.Date)</td>
                        <td>@Html.DisplayFor(_ => apft.PushUps)</td>
                        <td>@Html.DisplayFor(_ => apft.SitUps)</td>
                        <td>@Html.DisplayFor(_ => apft.Run)</td>
                        <td>@Html.DisplayFor(_ => apft.TotalScore)</td>
                        <td>
                            @if (apft.IsPassing)
                            {
                                <span class="label label-success">Passing</span>
                            }
                            else
                            {
                                <span class="label label-danger">Failure</span>
                            }
                        </td>
                        <td>@Html.ActionLink("Details", "Details", "APFT", new { apft.Id })</td>
                    </tr>
                }
            </tbody>
        </table>

        @if (Model.APFTs.Count > 1)
        {
            <div id="apft_chart"></div>
        }
    </div>
</div>

<div class="panel panel-default">

    <div class="panel-heading">
        <h2 class="panel-title">@Html.DisplayNameFor(_ => _.ABCPs) @Html.ActionLink("Add New", "New", "ABCP", new { soldier = Model.Id }, new { @class = "btn btn-default btn-xs" })</h2>
    </div>

    <div class="panel-body">
        <table class="table">
            <thead>
                <tr>
                    <th>@Html.DisplayNameFor(_ => _.ABCPs.FirstOrDefault().Date)</th>
                    <th>@Html.DisplayNameFor(_ => _.ABCPs.FirstOrDefault().Weight)</th>
                    <th>@Html.DisplayNameFor(_ => _.ABCPs.FirstOrDefault().Screening_Weight)</th>
                    <th>@Html.DisplayNameFor(_ => _.ABCPs.FirstOrDefault().IsPassing)</th>
                    <th></th>
                </tr>
            </thead>

            <tbody>
                @foreach (var abcp in Model.ABCPs.OrderByDescending(_ => _.Date))
                {
                    <tr>
                        <td>@Html.DisplayFor(_ => abcp.Date)</td>
                        <td>@Html.DisplayFor(_ => abcp.Weight)</td>
                        <td>@Html.DisplayFor(_ => abcp.Screening_Weight)</td>
                        <td>
                            @if (abcp.IsPassing)
                            {
                                <span class="label label-success">Passing</span>
                            }
                            else
                            {
                                <span class="label label-danger">Failure</span>
                            }
                        </td>
                        <td>@Html.ActionLink("Details", "Details", "ABCP", new { abcp.Id })</td>
                    </tr>
                }
            </tbody>
        </table>

        @if (Model.ABCPs.Count > 1)
        {
            <div id="abcp_chart"></div>
        }
    </div>
</div>

<div>
    @using (Html.BeginForm("Delete", "Soldiers", new { Model.Id }, FormMethod.Post))
            {
        @Html.AntiForgeryToken()
        <button type="submit" class="btn btn-danger">Delete</button>
    }
</div>

@section Scripts
{
    @{
        var apft_data =
            Model
            .APFTs
            .OrderBy(apft => apft.Date)
            .Select(apft => new
            {
                date = apft.Date.ToString("yyyy-MM-dd"),
                score = apft.TotalScore
            })
            .ToList();

        var abcp_data =
            Model
            .ABCPs
            .OrderBy(abcp => abcp.Date)
            .Select(abcp => new
            {
                date = abcp.Date.ToString("yyyy-MM-dd"),
                weight = abcp.Weight
            })
            .ToList();
    }

    <!--Load the AJAX API-->
    <script type="text/javascript" src="https://www.gstatic.com/charts/loader.js"></script>
    <script type="text/javascript">
        // Load the Visualization API and the corechart package.
        google.charts.load('current', { 'packages': ['corechart'] });

        // Set a callback to run when the Google Visualization API is loaded.
        google.charts.setOnLoadCallback(draw_apft_chart);

        var apft_data = JSON.parse('@Json.Serialize(apft_data)');

        var abcp_data = JSON.parse('@Json.Serialize(abcp_data)');

        function draw_apft_chart() {
            // Create the data table.
            var data = new google.visualization.DataTable();

            data.addColumn('date', 'Date');
            data.addColumn('number', 'Score');

            for (var i = 0; i < apft_data.length; i++)
            {
                data.addRow([new Date(apft_data[i].date), apft_data[i].score]);
            }

            var chart = new google.visualization.LineChart(document.getElementById('apft_chart'));

            chart.draw(data, {
                title: 'APFT Scores',
                legend: { position: 'bottom' }
            });
        }

        function draw_abcp_chart() {
            // Create the data table.
            var data = new google.visualization.DataTable();

            data.addColumn('date', 'Date');
            data.addColumn('number', 'Weight');

            for (var i = 0; i < abcp_data.length; i++) {
                data.addRow([new Date(abcp_data[i].date), abcp_data[i].weight]);
            }

            var chart = new google.visualization.LineChart(document.getElementById('abcp_chart'));

            chart.draw(data, {
                title: 'ACBP - Weight',
                legend: { position: 'bottom' }
            });
        }
    </script>
}